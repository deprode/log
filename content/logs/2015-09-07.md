+++
Categories = ["log"]
Description = "PHPまた直してる"
Tags = ["PHP"]
Title = "2015 09 07"
date = "2015-09-07T23:32:50+09:00"

+++

## PHPまた直してる
また直してる。

PHPは5.3.2で、flockがfcloseで自動的に解除されなくなった。あまりファイルロック操作をしなかったこともあって、知らなかった。昔はどうだったのか知らないけど、LOCK_EXなどの定義済みの値があるが使ってなかったので使うようにした。

ディレクトリロックの仕様があったのだが、削除した。ディレクトリロックは、Windows95/98（NFS）と一部のUnixで使われているのだが、使われている環境が確認できないことがあり、削除した。ただ、使われている環境が知らないところであるかもしれないので復活するかもしれない。

そのほか、リファクタリングをした。リファクタリング、生産性は0に近いのだがコードの質を上げることで生産速度が上がったり手戻りが発生しにくくなるので、道路の補修工事のような感じ。壊れる前に直して、快適に走る。

staticでいいものはstaticにしたり、クラス名と重複している変数名を短くしたり、制御と表示を分けたり、多少遅くなっても読みやすさ重視で直す、などの改善をした。

読みやすさを重視するのはコードを書く速度を上げるため、という理由のほかに、きれいな遅いコードから汚い速いコードにするのは簡単だけど、逆は時間がかかるため、きれいなコード重視でやっている。

コードが最初からきれいに書ければいいんだけど、時流や体調、環境に左右されずに万全の状態でないと書くことは難しいと思う。きれいの水準が上がっていることも、きれいに書くことが難しい一因になっている。

リーダブルコードを読み直すときなのかもしれない。リファクタリングも。

----

今日の日記、かなり論理が飛び飛びで読みづらいと思うけど、これもきれいに書くことが難しい原因の一つである"疲労困憊"があげられると思う。